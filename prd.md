PRD: 캔버스 생존 슈터 (React)

목표: 이 문서를 프롬프트로 그대로 사용해도 첫 시도에서 구현 가능한 수준으로 요구사항을 명확히 한다.

1) 기본 동작(모바일 레이아웃)
- 모바일에서는 게임 캔버스 전체가 항상 보인다(contain). 확대/축소 시 비율 유지.
- 모바일에서 캔버스는 화면 상단 정렬한다. 중앙 정렬 금지.
- 스케일/좌표 공식(필수):
  - `scale = min(vw/800, vh/600)`
  - `cssWidth = round(800*scale)`, `cssHeight = round(600*scale)`
  - `offsetLeft = floor((vw - cssWidth)/2)`, `offsetTop = max(vh - cssHeight - safeBottom, 0)`
  - 입력 변환: `logicalX = (clientX - offsetLeft)/scale`, `logicalY = (clientY - offsetTop)/scale`
- 캔버스 해상도: `dpr = min(devicePixelRatio||1, 2)`로 캡. `canvas.width/height = cssWidth/Height * dpr`, `ctx.setTransform(dpr*scale,0,0,dpr*scale,0,0)`.
- 안전영역: `padding-bottom: env(safe-area-inset-bottom)` 반영.

2) 구현해야 할 기능(체크리스트)
- 조작/이동: 데스크톱 WASD/방향키, 모바일 가상 조이틱. 경계 밖 이동 금지.
- 최상단의 점수 표시(HUD): 상단 중앙 고정. `Score: <총점> | Time: <mm:ss>`.
- 좌측 상단 상태 패널: Level, XP(선택), FireRate, Damage 등 상태 표기.
- 충돌 및 게임오버: 플레이어-적 접촉 시 즉시 게임오버, 오버레이 표시, 재시작 버튼.
- 점수 규칙: 시간 점수(1초당 +1) + 처치 점수(일반 +1, 보스 +5) = 총점.
- 자동 공격: 0.5초 간격 자동 발사. 이동 중엔 입력 벡터 방향, 정지 시 최근/가까운 적 방향.
- 레벨업과 일시정지: 레벨 임계(10,20,40,80,…) 도달 시 3선택 모달 표시, 표시 중에는 게임 루프/입력/스폰/발사/충돌 모두 정지. 선택 즉시 재개, 초과 XP 이월.
- 모바일 조이틱 규칙: pointerdown으로 표시, 같은 포인터로 move 추적(setPointerCapture), pointerup 즉시 숨김. 멀티터치 시 최초 포인터 1개만 입력. 컨테이너에 `touch-action:none; overscroll-behavior:none; user-select:none` 적용, 리스너는 `{passive:false}` + `preventDefault()`.
- 반응형 캔버스 레이아웃: 800×600 논리 고정, contain 스케일, 모바일 하단 정렬, 회전/주소창 변화에 100ms 이내 재계산.

3) 기본 상수(예시, 고정)
- 플레이어: 속도 200 px/s, 히트박스 반지름 12 px, 발사 간격 0.5 s.
- 투사체: 속도 420 px/s, 반지름 4 px, 수명 1.8 s, 데미지 1.
- 적(일반): 속도 80 px/s, 반지름 16 px, HP 1.
- 보스: 60 s에 1회 스폰, 속도 60 px/s, 반지름 24 px, HP 10, 처치 점수/XP +5.
- 스폰: 시작 1.2 s 주기, 10 s마다 10% 단축, 최소 0.4 s. 플레이어와 최소거리 120 px, 화면 밖 30 px 링에서 스폰. 동시 적 최대 50.

4) 충돌/히트박스
- 전 엔티티 원형 히트박스 사용(circle). 두 중심 거리 ≤ (r1 + r2)면 충돌.
- 플레이어-적 충돌 시 즉사(HP/무적 없음). 투사체는 적 명중 시 소멸(관통 파워업 예외).

5) 수용 기준(AC)
- 어떤 모바일 뷰포트에서도 캔버스 전체가 보이고 하단 정렬된다.
- 모달/게임오버 표시 중에는 타이머/스코어/스폰/발사/충돌/입력이 모두 정지한다.
- 60초 생존, 일반 5킬, 보스 1킬 시 총점 = 시간(60) + 처치(10) = 70.
- 자동 발사 주기 오차는 60FPS 기준 ±1프레임 이내.

6) 테스트 시나리오(요약)
- 기기: iPhone 12/SE, Galaxy S10/S22, iPad, 1366×768/1920×1080.
- 케이스: 세로/가로 전환, 주소창 숨김/표시, 장시간 조이틱 드래그, 모달 중 입력 차단, 재시작 동작.

7) 자산/표기
- 이미지 비율 보존(±10% 이내). `public/*.png` 자산 사용. 렌더 배율은 히트박스 반지름 기준.

위 항목을 그대로 준수하여 구현한다. 재량 항목은 본 문서의 수치/공식을 우선한다.
